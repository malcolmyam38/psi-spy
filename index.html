<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>PSI SPY Project</title>
    <!-- bootstrap -->
    <link href="css/bootstrap.min.css" rel="stylesheet" />
    <!-- own css file -->
    <link href="css/main.css" rel="stylesheet" />
  </head>
  <body>
    <nav class="navbar navbar-expand-md navbar-dark bg-dark fixed-top">
      <a class="navbar-brand" href="#">Navbar</a>
      <button
        class="navbar-toggler"
        type="button"
        data-toggle="collapse"
        data-target="#navbarsExampleDefault"
        aria-controls="navbarsExampleDefault"
        aria-expanded="false"
        aria-label="Toggle navigation"
      >
        <span class="navbar-toggler-icon"></span>
      </button>

      <div class="collapse navbar-collapse" id="navbarsExampleDefault">
        <ul class="navbar-nav mr-auto">
          <li class="nav-item active">
            <a class="nav-link" href="#"
              >Home <span class="sr-only">(current)</span></a
            >
          </li>
        </ul>
        <form class="form-inline my-2 my-lg-0">
          <input
            class="form-control mr-sm-2"
            type="text"
            placeholder="Search"
            aria-label="Search"
          />
          <button class="btn btn-secondary my-2 my-sm-0" type="submit">
            Search
          </button>
        </form>
      </div>
    </nav>

    <main role="main" class="container">
      <div class="starter-template">
          <div style="width:250px;margin:0 auto;">
              <svg data-v-fde0c5aa="" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 300 300" class="iconLeftSlogan"><!----><defs data-v-fde0c5aa=""><!----></defs><rect data-v-fde0c5aa="" fill="transparent" x="0" y="0" width="300px" height="300px" class="logo-background-square"></rect><defs data-v-fde0c5aa=""><!----></defs><g data-v-fde0c5aa="" id="ee3c8001-7ef3-4627-920c-ab749478e7fe" fill="#000000" transform="matrix(2.853278636932373,0,0,2.853278636932373,113.37000447643548,111.52427849818773)"><path d="M1.26 14.88L2.66 14.88L2.66 11.12L6.15 11.12L7.77 10.18L7.77 6.02L6.15 5.08L1.26 5.08ZM2.66 6.34L6.37 6.34L6.37 9.86L2.66 9.86ZM10.01 9.70L11.63 10.64L15.12 10.64L15.12 13.69L11.27 13.69L11.27 12.57L9.87 12.57L9.87 14.01L11.49 14.95L14.90 14.95L16.52 14.01L16.52 10.18L14.90 9.24L11.41 9.24L11.41 6.27L15.12 6.27L15.12 7.39L16.52 7.39L16.52 5.95L14.90 5.01L11.63 5.01L10.01 5.95ZM19.04 14.88L20.44 14.88L20.44 5.08L19.04 5.08ZM26.60 9.70L28.22 10.64L31.71 10.64L31.71 13.69L27.86 13.69L27.86 12.57L26.46 12.57L26.46 14.01L28.08 14.95L31.49 14.95L33.11 14.01L33.11 10.18L31.49 9.24L28.00 9.24L28.00 6.27L31.71 6.27L31.71 7.39L33.11 7.39L33.11 5.95L31.49 5.01L28.22 5.01L26.60 5.95ZM35.63 14.88L37.03 14.88L37.03 11.12L40.52 11.12L42.14 10.18L42.14 6.02L40.52 5.08L35.63 5.08ZM37.03 6.34L40.74 6.34L40.74 9.86L37.03 9.86ZM46.69 14.88L48.09 14.88L48.09 10.57L51.39 5.08L49.83 5.08L47.40 9.25L47.38 9.25L44.97 5.08L43.40 5.08L46.69 10.56Z"></path></g><defs data-v-fde0c5aa=""><linearGradient data-v-fde0c5aa="" gradientTransform="rotate(25)" id="fc5e5009-d5ad-484c-bec2-9196efd14599" x1="0%" y1="0%" x2="100%" y2="0%"><stop data-v-fde0c5aa="" offset="0%" stop-color="#288B58" stop-opacity="1"></stop><stop data-v-fde0c5aa="" offset="100%" stop-color="#1522F1" stop-opacity="1"></stop></linearGradient></defs><g data-v-fde0c5aa="" id="d1f2202d-2ba6-4c82-ae5f-e806bd24ab4b" stroke="none" fill="url(#fc5e5009-d5ad-484c-bec2-9196efd14599)" transform="matrix(0.7660495042800903,0,0,0.7660495042800903,33.66323806219145,111.73582474588038)"><path d="M74.7 50.4c-.8-5.2-3.2-10.1-7-13.9-4.7-4.7-11-7.3-17.7-7.3s-13 2.6-17.7 7.3c-3.8 3.8-6.2 8.7-7 13.9-9.6 1.8-17 10.3-17 20.4 0 11.5 9.3 20.8 20.8 20.8h41.7c11.5 0 20.8-9.3 20.8-20.8.1-10.1-7.3-18.6-16.9-20.4zm-3.9 32.9H29.2c-6.9 0-12.5-5.6-12.5-12.5s5.6-12.5 12.5-12.5c3.3 0 6.5 1.3 8.8 3.7l5.9-5.9c-2.8-2.8-6.3-4.7-10.1-5.6.7-3.1 2.2-5.9 4.5-8.2 6.3-6.3 17.3-6.3 23.6 0 3.1 3.1 4.9 7.3 4.9 11.8 0 4.5-1.7 8.6-4.9 11.8l5.9 5.9c3.6-3.6 5.9-8 6.9-12.9 5.1 1.6 8.8 6.3 8.8 11.9-.2 6.9-5.8 12.5-12.7 12.5zM45.8 8.3h8.3v12.5h-8.3zM36.995 23.226l-7.188 4.149-6.25-10.826 7.19-4.15zM12.421 27.65L23.247 33.9l-4.149 7.188L8.272 34.84zM76.563 16.528l-6.25 10.825-7.188-4.15 6.25-10.825zM87.622 27.62l4.15 7.189-10.827 6.248-4.15-7.188z"></path></g><defs data-v-fde0c5aa=""><!----></defs><g data-v-fde0c5aa="" id="5f59cbc3-2161-43fa-a85b-0d6902028693" fill="#000000" transform="matrix(0.6980375051498413,0,0,0.6980375051498413,116.17635319617348,163.00809151911565)"><path d="M6.97 6.75C7.63 6.45 8.22 5.85 8.22 4.66C8.22 3.54 7.48 2.21 5.29 2.21L1.13 2.21L1.13 11.48L5.53 11.48C7.64 11.48 8.69 10.43 8.69 9.04C8.69 7.66 7.76 7 6.97 6.75ZM2.18 3.21L5.40 3.21C6.68 3.21 7.17 3.98 7.17 4.75C7.17 5.88 6.26 6.36 5.29 6.36L2.18 6.36ZM5.64 10.49L2.18 10.49L2.18 7.31L5.53 7.31C7 7.31 7.64 8.09 7.64 8.96C7.64 9.93 6.92 10.49 5.64 10.49ZM20.30 10.64C18.89 10.64 17.98 9.65 17.82 8.40L23.69 8.40L23.69 7.98C23.69 5.98 22.36 4.37 20.22 4.37C18.07 4.37 16.74 5.98 16.74 7.98C16.74 9.98 18.14 11.59 20.29 11.59C21.95 11.59 22.99 10.72 23.48 9.46L22.33 9.46C21.95 10.16 21.28 10.64 20.30 10.64ZM20.22 5.32C21.56 5.32 22.40 6.23 22.60 7.42L17.84 7.42C18.03 6.23 18.87 5.32 20.22 5.32ZM34.41 4.37C32.61 4.37 31.67 5.11 31.67 6.37C31.67 8.93 36.33 7.84 36.33 9.59C36.33 10.54 35.11 10.70 34.54 10.70C33.18 10.70 32.65 10.00 32.58 9.28L31.49 9.28C31.56 10.51 32.58 11.59 34.52 11.59C36.26 11.59 37.38 10.85 37.38 9.49C37.38 6.86 32.72 7.95 32.72 6.27C32.72 5.59 33.29 5.26 34.38 5.26C35.56 5.26 36.01 5.75 36.09 6.36L37.16 6.36C37.03 5.33 36.26 4.37 34.41 4.37ZM47.53 11.48L47.53 5.40L49.14 5.40L49.14 4.48L47.53 4.48L47.53 1.97L46.48 1.97L46.48 4.48L45.05 4.48L45.05 5.40L46.48 5.40L46.48 11.48ZM68.54 8.18L71.67 8.18C73.64 8.18 74.86 7.03 74.86 5.19C74.86 3.37 73.64 2.21 71.67 2.21L67.49 2.21L67.49 11.48L68.54 11.48ZM71.60 3.21C73.05 3.21 73.81 3.96 73.81 5.19C73.81 6.44 73.05 7.20 71.60 7.20L68.54 7.20L68.54 3.21ZM83.90 4.65C83.90 4.03 84.27 3.08 86.37 3.08C88.06 3.08 88.84 3.82 88.96 4.75L90.03 4.75C89.95 3.36 88.83 2.10 86.37 2.10C84.04 2.10 82.88 3.15 82.88 4.66C82.88 7.84 89.22 6.69 89.22 8.96C89.22 10.05 88.24 10.60 86.67 10.60C85.06 10.60 83.76 10.05 83.69 8.71L82.60 8.71C82.74 10.37 83.86 11.59 86.60 11.59C88.89 11.59 90.27 10.64 90.27 8.92C90.27 5.68 83.90 6.80 83.90 4.65ZM99.95 2.21L98.90 2.21L98.90 11.48L99.95 11.48ZM120.25 2.21L119.20 2.21L119.20 11.48L120.25 11.48ZM129.29 4.48L129.29 11.48L130.34 11.48L130.34 7.45C130.34 6.19 131.29 5.32 132.45 5.32C133.60 5.32 134.41 6.16 134.41 7.43L134.41 11.48L135.46 11.48L135.46 7.41C135.46 5.42 134.11 4.37 132.66 4.37C131.53 4.37 130.84 4.90 130.34 5.57L130.34 4.48ZM147.17 4.37C145.12 4.37 143.78 5.98 143.78 7.98C143.78 9.98 145.12 11.59 147.17 11.59C148.33 11.59 149.16 11.12 149.67 10.36L149.67 11.48L150.72 11.48L150.72 1.68L149.67 1.68L149.67 5.61C149.16 4.86 148.33 4.37 147.17 4.37ZM147.31 10.64C145.75 10.64 144.83 9.42 144.83 7.98C144.83 6.54 145.75 5.32 147.31 5.32C148.86 5.32 149.73 6.54 149.73 7.98C149.73 9.42 148.86 10.64 147.31 10.64ZM162.67 10.64C161.25 10.64 160.34 9.65 160.19 8.40L166.05 8.40L166.05 7.98C166.05 5.98 164.72 4.37 162.58 4.37C160.44 4.37 159.11 5.98 159.11 7.98C159.11 9.98 160.51 11.59 162.65 11.59C164.32 11.59 165.35 10.72 165.84 9.46L164.70 9.46C164.32 10.16 163.65 10.64 162.67 10.64ZM162.58 5.32C163.93 5.32 164.77 6.23 164.96 7.42L160.20 7.42C160.40 6.23 161.24 5.32 162.58 5.32ZM179.70 4.48L178.36 4.48L176.57 7.13L174.76 4.48L173.42 4.48L175.95 7.87L173.25 11.48L174.58 11.48L176.57 8.62L178.54 11.48L179.89 11.48L177.17 7.87ZM190.67 10.64C189.25 10.64 188.34 9.65 188.19 8.40L194.05 8.40L194.05 7.98C194.05 5.98 192.72 4.37 190.58 4.37C188.44 4.37 187.11 5.98 187.11 7.98C187.11 9.98 188.51 11.59 190.65 11.59C192.32 11.59 193.35 10.72 193.84 9.46L192.70 9.46C192.32 10.16 191.65 10.64 190.67 10.64ZM190.58 5.32C191.93 5.32 192.77 6.23 192.96 7.42L188.20 7.42C188.40 6.23 189.24 5.32 190.58 5.32ZM205.97 4.37C204.23 4.37 203.53 5.73 203.39 6.20L203.39 4.48L202.34 4.48L202.34 11.48L203.39 11.48L203.39 8.40C203.39 6.86 204.34 5.42 205.91 5.42L206.04 5.42L206.04 4.37Z"></path></g></svg>
          </div>
          <!--
        <h1>AIR QUALITY</h1>
        <p class="lead">PSI sample</p>
          -->
      </div>
      <div class="row">
        <div class="col" id="map">Maps</div>
        <div class="col" id="latest-data-container">
            <!-- contain latest state number only -->
            <div style="display:inline-block;position:relative;vertical-align:middle;">
                <div class="stats-placeholder">
                    <div class="stats-content">
                        <span class="latest-psi-state">49</span>
                    </div>
                </div>
            </div>
            <!-- contain latest stat details -->
            <span class="latest-details-wrapper"> 
                <span class="latest-psi-status">Good</span>
                <span class="latest-psi-time-wrapper">
                    PSI Value
                    <span class="latest-psi-time">At 4pm on 18 Aug 2020</span>
                </span>

            </span>

        </div>
        <div class="col psi-values" id="psi-table">
          <table class="table">
            <thead>
              <tr>
                <th scope="col">PSI Value</th>
                <th scope="col">Air Quality Descriptor</th>
              </tr>
            </thead>
            <tbody>
              <tr class="psi-good">
                <td>0-50</td>
                <td>Good</td>
              </tr>
              <tr class="psi-moderate">
                <td>51-100</td>
                <td>Moderate</td>
              </tr>
              <tr class="psi-unhealthy">
                <td>101-200</td>
                <td>Unhealthy</td>
              </tr>
              <tr class="psi-very-unhealthy">
                <td>201-300</td>
                <td>Very Unhealthy</td>
              </tr>
              <tr class="psi-hazardous">
                <td>Above 300</td>
                <td>Hazardous</td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </main>
    <!-- /.container -->

    <!-- bootstrap n jquery -->
    <script src="js/jquery.min.js"></script>
    <script src="js/bootstrap.bundle.min.js"></script>
    <!-- own js script-->
    <script src="js/main.js"></script>

    <script
    src="https://maps.googleapis.com/maps/api/js?key=&callback=initMap"
    async
    defer
  ></script>
  <script>
      //global map variables
      let map;
      let markers = [];
      //NEA PSI locations
      let locations = [
          {name: "west",lat: 1.35735,lng: 103.7,}, //0
          {name: "national",lat: 0,lng: 0},//1
          {name: "east",lat:1.35735,lng: 103.94},//2
          {name: "central",lat: 1.35735,lng: 103.82},//3
          {name: "south",lat:1.29587,lng: 103.82},//4
          {name: "north",lat:1.41803,lng:103.82}//5
        ];

      function initMap(){
        let singaporeLocation = {lat: 1.3521, lng: 103.8198}

        map = new google.maps.Map(document.getElementById("map"),
        { //settings/options
          center: singaporeLocation,
            zoom: 10,
            zoomControl: false,
            scaleControl: false
        });

        //add markers when map is initialized
        for(let i = 0; i < locations.length; i++){
          console.log(locations[i]);
          let markerPosition = {"lat": locations[i].lat, "lng": locations[i].lng};
          
          addMarker(markerPosition, locations[i].name, map);
        }
        
      }//end initMap
  
      function addMarker(markerPosition, markerTitle, mapReference){
        
        //create infoWindow
        let infowindow = new google.maps.InfoWindow({
          content: `<div id=''>Some text</div>`
        })

        //create marker
        let marker = new google.maps.Marker({
          position: markerPosition,
          map: mapReference,
          animation: google.maps.Animation.DROP,
          title: markerTitle
        });

        //add Click event listener and open infowin when we click on a marker
        //retrieve from localstorage psi info and update
        marker.addListener('click', function(){
            //${marker.title}--> reference to east/west/etc..
            //retreive from localstorage data 
            let psiStorage = `${marker.title}PSI`; //eastPSI west PSI etc.. 
            
            let infowindowContent = "";//temp infowindowcontent
            //if localstorage is available use that 
            if(localStorage.getItem(psiStorage) !== ""){
                //do sth
                infowindowContent = localStorage.getItem(psiStorage);//
            }else{
                //else do normal ajax api query here
                infowindowContent = "";
            }
            infowindow.setContent(`<h6>${psiStorage}</h6>PSI: ${localStorage.getItem(psiStorage)}`);

            infowindow.open(mapReference, marker);
        });
      }//end addMarker
  </script>


  </body>
</html>
